# 模块参数(5)

## secrets file(密钥文件)
- 这个参数指定了一个包含用户名:密码和/或@groupname:密码对的文件名，该文件用于验证本模块的身份。
- 只有在指定了 "auth users "参数的情况下，才会查看这个文件。
- 这个文件是以行为基础的，每行包含一个用户名:密码对。
- 任何一行都有一个哈希值(#)，因为该行的第一个字符被认为是注释，会被跳过。
- 密码可以包含任何字符，但要注意的是，许多操作系统限制了在客户端可以输入的密码长度，
- 可能会发现超过8个字符的密码无法使用。

- 只有当模块正在使用匹配的"@groupname "规则进行授权时，才会使用组特定行。
- 在这种情况下，用户可以通过他们的 "username:password "行或触发认证的组的"@groupname:password "行进行授权。

- 这取决于你想包含什么样的密码条目，可以是用户，也可以是组，或者两者都有。
- 在 "auth用户 "中使用组规则，如果你不想使用共享密码，就不需要指定组密码。

- "secrets文件 "参数没有默认值，您必须选择一个名称（如/etc/rsyncd.secrets）。
- 该文件通常不能被 "其他 "读取，参见 "严格模式"。
- 如果找不到该文件或该文件被拒绝，"用户授权 "模块将无法登录。

## strict modes(严谨模式)
- 这个参数决定是否会检查秘密文件的权限。
- 如果 "strict modes "为真，那么除了rsync守护进程运行的用户ID之外，其他用户ID都不能读取秘密文件。
- 如果 "strict modes "为false，则不执行检查。默认值为true。
- 添加这个参数是为了适应在Windows操作系统上运行的rsync。

## hosts allow(允许主机)
- 此参数允许您指定一个逗号和/或空格分隔的模式列表，这些模式与连接客户端的主机名和IP地址相匹配。
- 如果没有一个模式匹配，那么连接将被拒绝。

- 六种形式

- `10.0.0.1`
> a.b.c.d形式的点阵十进制IPv4地址，或a:b:c::d:e:f形式的IPv6地址。在这种情况下，接收机器的IP地址必须完全匹配。

- `10.0.0.1/24`
> 地址/掩码，格式为ipaddr/n，其中ipaddr是IP地址，n是网掩码中的一位数。所有与屏蔽的IP地址相匹配的IP地址都将被允许进入。

- 地址/掩码
> 格式为ipaddr/maskaddr，其中ipaddr是IP地址，maskaddr是netmask，对于IPv4来说，用点十进制表示，对于IPv6来说，用类似的方式表示，例如：fffff:fffff:fffff::代替/64。所有与屏蔽的IP地址相匹配的IP地址都将被允许进入。

- 主机名
> 主机名。普通主机名与连接IP的反向DNS匹配（如果启用了 "反向查找"），和/或给定主机名的IP与连接IP匹配（如果启用了 "正向查找"，默认情况下是这样）。任何匹配都会被允许进入。

- 一个'@'
> 后面跟着一个网组名称，如果连接IP的反向DNS在指定的网组中，那么这个网组就会匹配。

- 注意IPv6链路本地地址在地址规范中可以有一个范围。:
```
fe80::1%link1
fe80::%link1/64
fe80::%link1/ffff:ffff:ffff:ffff::
```

补充：
- 您也可以将 "hosts allow "与 "hosts deny "结合起来，作为向拒绝列表添加异常的一种方式。
- 当指定了这两个参数时，首先检查 "hosts allow "参数，匹配的结果是客户端能够连接。
- 然后将不允许的主机与 "主机拒绝 "列表进行匹配，看是否应该拒绝。不符合这两个列表的主机则被允许连接。

- 默认情况下，没有 "hosts allow "参数，即所有主机都可以连接。

## hosts deny(拒绝主机)
- 这个参数允许你指定一个逗号和/或空格分隔的模式列表，这些模式与连接客户的主机名和IP地址相匹配。
- 如果模式匹配，那么连接将被拒绝。更多信息请参见 "hosts allow "参数。
- 默认情况下没有 "hosts deny "参数，即所有主机都可以连接。

## reverse lookup（反向查找）
- 控制守护进程是否对客户端的 IP 地址进行反向查找，以确定其主机名，
- 该主机名用于 "hosts allow "和 "hosts deny "检查和"%h "日志转义。

- 默认情况下是启用的，但如果你知道查找不会返回有用的结果，
- 你可能希望禁用它以节省时间，在这种情况下，守护进程将使用 "UNDETERMINED "来代替。

- 如果这个参数是全局启用的（即使是默认情况下），
- 那么rsync会在客户端连接时立即执行查找，因此禁用它并不能避免对模块的查找。
- 因此，你可能希望全局禁用它，然后为需要信息的模块启用它。

## forward lookup（正向查找）
- 控制守护进程是否对主机允许/拒绝设置中指定的任何主机名执行正向查找。
- 默认情况下，这是启用的，允许使用一个明确的主机名，而这个主机名不会被连接IP的反向DNS返回。

## ignore errors（忽略错误）
- 这个参数告诉rsyncd在决定是否执行传输的删除阶段时，忽略守护进程上的I/O错误。
- 通常情况下，如果发生了任何I/O错误，rsync会跳过--delete步骤，
- 以防止由于暂时的资源短缺或其他I/O错误造成灾难性的删除。
- 在某些情况下，这种测试是适得其反的，所以你可以使用这个参数来关闭这种行为。

## ignore nonreadable（rsync守护进程忽略用户不可读文件）
- 这将告诉rsync守护进程完全忽略用户不可读的文件。
- 这对于公共档案中可能有一些不可读的文件
- 而系统管理员又不想让这些文件被看到的情况很有用。