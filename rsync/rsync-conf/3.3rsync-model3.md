# 模块参数(3)

## charset（字符集）

`charset = UTF-8`
`charset = GBK`
`C.UTF-8`

- 这指定了存储模块文件名的字符集的名称，
- 如果客户端使用了--iconv选项，则无论客户端实际传递的是什么字符集，守护进程都会使用 "charset "参数的值。

- 允许守护进程支持chroot模块中的字符集转换，
- 而不需要chroot区域中的额外文件，并且还可以确保以一致的方式完成名称转换。

- 如果没有设置 "charset "参数，则拒绝使用--iconv选项，就像通过 "拒绝选项 "指定 "iconv "一样。

- 如果你想强制用户对某个模块使用--iconv，请在 "拒绝选项 "中添加 "no-iconv"。
- 请注意，这将限制新的rsync客户端访问你的模块。

## max connections（最大连接数）

- 该参数允许您指定允许的最大同时连接数。
- 当达到最大连接数时，任何客户端都会收到一条消息，告诉他们稍后再试。
- 默认值是0，表示没有限制。负值会禁用该模块。也请参考 "锁文件（lock file(锁文件)）"参数。

## log file(日志文件)

- 当 "log file "参数被设置为非空字符串时，rsync守护进程会将消息记录到指定的文件中，而不是使用syslog。
- 这在syslog()不能用于chroot程序的系统（比如AIX）中特别有用。
- 该文件在调用chroot()之前就被打开了，因此可以将其放在传输之外。
- 如果这个值是在每个模块而不是全局的基础上设置的，全局日志仍然会包含任何授权失败或配置文件错误信息。

- 如果守护进程无法打开指定的文件，它将回到使用syslog的状态，并输出一个关于失败的错误。
- (注意，未能打开指定的日志文件曾经是一个致命的错误。)

- 这个设置可以通过使用--log-file=FILE或--dparam=logfile=FILE命令行选项来覆盖。
- 前者会覆盖守护进程的所有日志文件参数和所有模块的设置，后者会设置守护进程的日志文件和所有模块的默认设置。
- 后者设置守护进程的日志文件和所有模块的默认值，它仍然允许模块覆盖默认设置。

## syslog facility（系统日志设施） 暂时未发现作用

> 估计是将日志使用其他服务，放入其他设备中

- 这个参数允许您指定从rsync守护进程记录消息时要使用的syslog设施名称。
- 您可以使用任何在您的系统上定义的标准syslog设施名称，常见的名称有auth, authpriv, cron, daemon, ftp, kern, lern等。
- 常见的名称有 auth, authpriv, cron, daemon, ftp, kern, lpr, mail, news, security, syslog, user, uucp, local0, local1, local2, local3, local4, local5, local6 和 local7。
- 默认为守护进程。如果 "日志文件 "设置为非空字符串（可以在每个模块设置中设置，也可以从全局设置中继承），则该设置没有效果。

## syslog tag(系统日志标记)
- 这个参数允许您指定从rsync守护进程记录消息时要使用的syslog标签。
- 默认值是 "rsyncd"。
- 如果 "log file "设置为非空字符串（在每个模块的设置中设置，或者从全局设置中继承），这个设置没有任何效果。

例如，如果你想让每个经过认证的用户的名字包含在syslog标签中，你可以这样做。
`syslog tag = rsyncd.%RSYNC_USER_NAME%`

## max verbosity(最大冗余)
- 这个参数允许你控制允许守护进程生成的最大数量的verbose信息（因为信息会进入日志文件）
- 默认值是1，允许客户端请求一个级别的verbosity。

- 这也会影响用户请求更高级别的-info和-debug日志的能力。
- 如果最大值是2，那么守护进程在其日志记录中不会接受高于-vv设置的info和/或debug值。
- 要查看您需要接受多高的信息/调试级别，请参考rsync --info=help和rsync --debug=help。
- 例如，需要max-verbosity 4才能输出调试TIME2和FLIST3。

## lock file(锁文件)
- 这个参数指定了用来支持 "最大连接数 "参数的文件。
- rsync守护进程使用此文件上的记录锁定来确保共享锁文件的模块不会超过最大连接数限制。
- 默认锁文件为/var/run/rsyncd.lock

## read only(只读)
> read only = yes
> read only = no

- 这个参数决定了客户端是否能够上传文件。
- 如果 "只读 "为真，那么任何尝试的上传都会失败。
- 如果 "只读 "为假，那么如果守护进程侧的文件权限允许，则可以上传文件。
- 默认情况下，所有模块都是只读。（经过测试，如果不设置，是可以上传的）

- 请注意，"auth用户 "可以在每个用户的基础上覆盖这个设置。

## write only(只写)
- 这个参数决定了客户端是否能够下载文件。
- 如果 "write only "为真，那么任何尝试的下载都会失败。
- 如果 "write only "为false，那么如果守护进程侧的文件权限允许，下载将是可能的。
- 默认情况下，这个参数是被禁用的。（经测试，如果未设置，可下载）

- 有用的提示：你可能想为一个只写的模块指定 "refuse options = delete"。

## open noatime（开放时间）

- 当设置为True时，这个参数告诉rsync守护进程打开带有O_NOATIME标志的文件（在支持该标志的系统中），
- 以避免改变正在传输的文件的访问时间。

- 如果你的操作系统不支持O_NOATIME标志，那么rsync会默默地忽略这个选项。
- 还需要注意的是，即使没有设置O_NOATIME标志，一些文件系统的挂载也会避免更新读取访问时的时间。

- 当设置为False时，该参数确保服务器上的文件不会被O_NOATIME打开。
- 当设置为Unset（默认）时，用户通过--open-noatime来控制设置。

## list（列表）
> 默认开启，远程使用list-only可以显示
> 全局设置list=no将全不现实，但是可以使用模块
> 模块设置list=no只影响模块

- 这个参数决定了当客户端要求提供可用模块列表时，这个模块是否被列出。
- 此外，如果这个参数为假，当被 "hosts allow "或 "hosts deny "拒绝的客户端试图访问该模块时，守护进程将假装该模块不存在。

- 果全局禁用了 "反向查找"，但对模块启用了，
- 那么由此产生的对潜在的客户端控制的DNS服务器的反向查找仍然可能向客户端显示它击中了一个现有的模块。

- 默认情况下，模块是可以列表的。

## uid(用户)
- 这个参数指定了当守护进程以root身份运行时，从该模块向该模块传输文件的用户名或用户ID。
- 结合 "gid "参数，它决定了什么文件权限是可用的。
- 超级用户运行时的默认值是切换到系统的 "nobody "用户。
- 非超级用户的默认值是不尝试改变用户。参见 "gid" 参数。

- RSYNC_USER_NAME 环境变量可以用来要求 rsync 作为授权用户运行。
- 例如，如果你想让rsync以收到的同一个用户的身份运行，这个设置就很有用。

```
uid = %RSYNC_USER_NAME%
gid = *

例子：
uid = root
git = root
```

## gid(用户组)
- 该参数指定了一个或多个组名/ID，在访问该模块时使用。第一个组是默认组，其他组将作为补充组。
- 您也可以指定一个 "*"作为列表中的第一个组名，它将被传输用户的所有正常组名所取代（参见 "uid"）。
- 超级用户运行时的默认值是切换到操作系统的 "nobody"(或者 "nogroup")组，没有其他补充组。

- 对于非超级用户来说，默认情况是不改变任何组的属性
- （事实上，你的操作系统可能不允许非超级用户尝试改变他们的组设置）。

- 指定的列表通常会根据空格和逗号分割成标记。
- 但是，如果列表以逗号开头，那么列表只以逗号分割，允许组名包含一个空格。
- 在这两种情况下，任何前导和/或尾部的空白都会从标记中删除，空的标记会被忽略。

## daemon uid(守护进程uid)
- 这个参数指定了守护进程运行的uid。
- 守护进程通常以root用户的身份运行，当这个参数未被设置时，用户将保持不变。参见 "uid "参数。

## daemon gid(守护进程运行的gid)
- 这个参数指定了守护进程运行的gid。
- 守护进程通常以组根的身份运行，当这个参数未设置时，该组将保持不变。也请参考 "gid "参数。