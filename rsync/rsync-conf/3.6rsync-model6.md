# 模块参数(6)

## transfer logging（格式化日志）
`值为true或false` 
- 这个参数可以使每个文件以类似于ftp守护进程使用的格式记录下载和上传。
- 守护进程总是在最后记录传输，所以如果传输中止，日志文件中不会提及。

- 如果你想自定义日志行，请参阅 "日志格式 "参数。

## log format(日志格式化)

`需要设置 transfer logging`

- 此参数允许您在启用传输日志记录时指定用于记录文件传输的格式。
- 该格式是一个文本字符串，其中包含以百分数 (%) 字符为前缀的嵌入式单字符转义序列。
- 还可以在百分数和转义字母之间指定一个可选的数字字段宽度（例如"%-50n %8l %07p"）。
- 此外，可以在数字转义符之前指定一个或多个省略号，以表示数字值应该更容易被人阅读。
- 支持的 3 个级别与 --human-readable 命令行选项相同，尽管默认情况下是关闭人机可读性。
- 每增加一个引号就会增加一个级别（例如"%''l %'b %f"）。

- 默认的日志格式是"%o %h [%a] %m (%u) %f %l"
- 当使用 "log file "参数时，"%t [%p]"总是被放在前面。
- (一个总结默认日志格式的 perl 脚本包含在 rsync 源代码发行版的 "support" 子目录中：rsyncstats。)

- 据了解，单字逃逸的情况如下。:
  - %a: 远程IP地址(只适用于守护进程)
  - %b: 实际传输的字节数
  - %B: 文件的权限位(如rwxrwxrwt)
  - %c: 收到的基础文件的块校验和的总大小(仅在发送时)
  - %C: 如果知道该文件的全文件校验和，那么它就是该文件的校验和。
    - 对于旧的rsync协议/版本，校验和是盐化的，因此不是一个有用的值（在这种情况下不会显示）。
    - 对于要为文件输出的校验和，必须使用--checksum选项，或者必须在未使用盐校验和的情况下传输文件
  - %f: 文件名(发件人的长格式，没有尾部的"/")
  - %G: 文件的gid（十进制）或 "DEFAULT"
  - %h: 远程主机名
  - %i: 更新内容的明细表
  - %l: 文件的长度（字节）
  - %L: 字符串"-> SYMLINK"，"=> HARDLINK"，或"" (其中SYMLINK或HARDLINK为文件名)
  - %m: 模块名
  - %M: 文件的最后修改时间
  - %n: 文件名(简称，尾部为"/")
  - %o: 操作，即 "发送"、"接收 "或 "删除"。(后者包括尾部的句号)
  - %p: 这个rsync会话的进程ID
  - %P: 模块路径
  - %t: 模块路径
  - %u: 已认证的用户名或一个空字符串
  - %U: 文件的uid(十进制)

- 关于"%i "输出的字符列表，请参见rsync手册中的--itemize-changes选项。
- 请注意，当与旧版rsync对话时，一些记录的输出会改变。
- 例如，在rsync 2.6.4之前，被删除的文件只能以啰嗦的信息输出。

## timeout(超时)
- 这个参数可以让你覆盖客户端对这个模块的I/O超时的选择，使用这个参数你可以确保rsync不会永远在死机上等待。
- 使用这个参数你可以确保rsync不会永远在死客户端上等待。
- 超时的单位是秒。值为0意味着没有超时，这是默认值。
- 对于匿名的rsync守护进程来说，600是一个不错的选择（给出10分钟的超时时间）。

## refuse options(拒绝选择)

```
例如：

[rsync]
path=/home/mrx/rsync
refuse options = list-only

这个模块将无法使用列表
rsync --port=8787 --list-only mrx@192.168.20.104::rsync
这样将会报错
```

- 这个参数允许您指定一个以空格分隔的 rsync 命令行选项列表，这些选项将被 rsync 守护进程拒绝。
- 您可以指定完整的选项名称，它的一个字母缩写，或者一个匹配多个选项的通配符字符串。
- 从3.2.0开始，您也可以用"！"来否定匹配项。

- 当一个选项被拒绝时，守护进程会打印一个错误信息并退出。
- 例如，这将拒绝--checksum (-c)和所有各种删除选项。
`refuse options = c delete`

- 上面之所以拒绝所有的删除选项，是因为选项中隐含了--delete，隐含的选项和显式选项一样被拒绝。
- 使用否定匹配可以在通配符后微调拒绝，例如：
`refuse options = delete-* !delete-during`

- 否定匹配也可以将您的拒绝选项列表变成接受选项列表。
- 要做到这一点，请以 "*"开头（拒绝所有选项），然后指定一个或多个否定匹配来接受。
- 例如：
`refuse options = * !a !v !compress*`

- 不要担心 "*"会拒绝某些重要的选项，如--dry-run、--server、--no-iconv、--protect-args等。
- 这些重要的选项是不能用通配符匹配的，所以必须用它们的确切名称来覆盖。
- 例如，如果你要强制传输iconv，你可以使用这样的方法。
`refuse options = * no-iconv !a !v`

- 作为一个额外的帮助（从3.2.0开始），
- 拒绝（或"！拒绝"）"a "或 "archive "选项也会影响所有--archive选项所包含的选项（-rdlptgoD），
- 但只有当该选项被显式匹配时（不使用通配符）。
- 如果你想做一些棘手的事情，你可以使用 "archive*"来避免这个副作用，
- 但是请记住，没有一个普通的rsync客户端会将实际的存档选项发送给服务器。

- 作为一个额外的安全特性，当守护进程是发送者时，拒绝 "delete "也会拒绝remove-source-files；
- 如果你想要后者而不想要前者，可以拒绝 "delete-*"，
- 因为它拒绝所有的删除模式而不影响--remove-source-files。
- (请记住，客户端的--delete选项通常会导致--delete-during)。


- 在解除拒绝删除选项时，
- 应指定"！删除*" (接受所有删除选项)或指定包括 "删除 "在内的一组有限的选项，
- 如：
`refuse options = * !a !delete !delete-during`

- 而这一做法接受除--delete-after以外的任何删除选项。：
`refuse options = * !a !delete* delete-after`

- 关于拒绝 "压缩 "的说明 -- 最好将 "dont compress "守护进程的参数设置为 "*"，
- 因为这样可以无声无息地禁止压缩，而不是返回一个错误，迫使客户端删除-z选项。

- 如果你不拒绝压缩选项，你可能要匹配"!compress*"，这样你也会接受 --compress-level 选项。

- 请注意，"write-devices "选项默认是拒绝的，但可以用"！write-devices "明确接受。
- "log-file "和 "log-file-format "这两个选项是被强行拒绝的，不能接受。

- 下面是所有没有通配符的选项:
  - --server: rsync工作所需
  - --rsh, -e: 需要向服务器传递兼容性标志。
  - --out-format:  这是将输出行为传递给远程接收器所必需的。由于兼容性的原因，rsync使用了旧的别名--log-format，但是这个选项不应该和--log-file-format混淆。
  - --sender: 使用 "只写 "参数，而不是拒绝这个。
  - --dry-run, -n: 谁会想禁用这个？
  - --protect-args, -s: 这实际上使转移更安全。
  - --from0, -0: 使得接受/拒绝--files-from更容易，而不影响这个有用的修改器。
  - --iconv: 这是根据 "charset "参数自动关闭的。
  - --no-iconv: 大多数转让都使用这个选项。
  - --checksum-seed: 是一个相当罕见、安全的选择。
  - --write-devices: 是非野生但也自动禁用。