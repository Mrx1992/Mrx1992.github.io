# 模块参数(2)

## daemon chroot(守护进程chroot)

- 这个参数指定了守护进程在开始与客户机通信之前要进行chroot的路径。
- 模块路径（以及任何 "使用chroot "的设置）将与这个路径相关。
- 这使您可以选择是否要对整个守护进程执行chroot（使用此设置），
- 还是只对传输进行chroote（使用“use chroot”），或两者都要。
- 请记住，"守护进程chroot "区域可能需要安装各种OS/lib/etc文件来允许守护进程运行。
- 默认情况下，守护进程不需要任何chroot就能运行。

## proxy protocol(代理协议)

- 启用该参数后，所有传入的连接必须以V1或V2代理协议头开始。如果没有找到该协议头，则关闭连接。
- 设置为 "true "时，需要代理服务器将源IP信息转发给rsync，这样您就可以记录正确的IP/主机信息，并使用面向客户端的IP限制。
- 默认的false意味着IP信息直接来自于套接字的元数据
- 如果rsync没有使用代理服务器，则应该禁用这个选项。

### 注意
- 如果您不确保只有代理服务器被允许连接到rsync端口，使用这个选项可能会很危险。
- 如果允许任何非代理连接，客户端将能够使用修改后的rsync来欺骗任何他们想要的远程IP地址。
- 你可以使用类似iptables -uid-owner root规则（用于严格的localhost访问）、各种防火墙规则来锁定这一点，
- 或者你可以要求密码授权，这样任何用户的欺骗行为都不会给予额外的访问权限。

- 这个设置是全局性的。如果您需要某些模块需要这个功能，而其他模块不需要，那么您将需要在不同的端口上设置多个 rsync 守护进程。

## name converter(换名器) 暂时未发现作用
- 这个参数可以让你指定一个由rsync守护进程运行的程序，来进行用户和组在名字和ID之间的转换。
- 这个脚本会在设置chroot之前启动，并以守护进程用户（而不是传输用户）的身份运行。
- 你可以指定一个完全限定的路径名或$PATH上的程序名。

- 该程序可以用来进行普通的用户和组查找，而不需要将任何额外的文件放入模块的chroot区域，或者你可以进行自定义转换。

- nameconvert程序可以访问所有的环境变量，这些环境变量在pre-xfer exec一节中有描述。
- 如果您想使用有关模块和/或复制请求的信息来定制转换，这很有用。

- 在支持目录中有一个名为 "nameconvert "的示例python脚本，它实现了正常的用户和组查找。
- 你可以自由地定制它，或者只是把它作为文档来实现你自己的脚本。

## numeric ids(数字化IDs) 暂时未发现作用
- 启用此参数可以禁用当前守护进程模块的用户和组的名称映射。
- 这将防止守护进程试图加载任何与用户/组相关的文件或库。
- 启用该参数后，传输的行为就像客户端通过了--numeric-ids命令行选项一样。
- 默认情况下，这个参数对chroot模块是启用的，对非chroot模块是禁用的。
- 另外请注意，uid/gid的保存需要模块以root身份运行(参见 "uid")，或者配置 "假超级"。

- 一个启用chroot的模块不应该把这个参数设置为false
- 除非你正在使用 "name converter "程序，或者你已经采取了措施来确保模块有必要的资源来翻译名字，
- 并且用户不可能改变这些资源。

## munge symlinks（符号链接）暂时未发现作用
- 这个参数告诉rsync以与（非守护进程影响的）
- --munge-links命令行选项相同的方式（使用下面描述的方法）修改所有符号链接。
- 当你的守护进程模块可写时，这应该有助于保护你的文件不被用户欺骗。
- 默认情况下，当 "use chroot "开启，且inside-chroot路径为"/"时，
- 或者当 "daemon chroot "开启时，会被禁用，否则会被启用。

- 如果你在一个非只读的守护进程上禁用了这个参数，
- 那么用户就可以利用上传的符号链接来访问守护进程排除的项目(如果你的模块有的话)，

- 而且，如果 "use chroot "是关闭的，那么rsync甚至可以被欺骗来显示或更改模块路径之外的数据(因为访问权限允许)。

- rsync禁用符号链接的方法是在每个链接前加上"/rsyncd-munged/"。
- 这样可以防止在该目录不存在的情况下使用这些链接。
- 当启用这个参数时，如果该路径是一个目录或指向目录的符号链接，rsync将拒绝运行。
- 当在chroot区域使用 "munge symlinks "参数时，如果该区域的内部chroot路径为"/"，应在模块的排除设置中添加"/rsyncd-munged/"，这样用户就无法尝试创建它。

- 注意：rsync不会尝试验证模块层次结构中任何已存在的符号链接是否如您所愿地安全（当然，除非它只是复制了整个层次结构）。
- 如果你在一个新的区域设置了一个rsync守护进程或者在本地添加了symlinks，
- 你可以通过在每个symlinks值的开头加上"/rsyncd-munged/"来手动保护你的symlinks不被滥用。
- 在源代码的support目录中有一个名为 "munge-symlinks "的perl脚本，可以用来添加或删除这个前缀。

- 当这个参数在可写模块上被禁用，
- 并且 "use chroot "被关闭时（或者内部chroot路径不是"/"），
- 传入的符号链接将被修改为去掉一个前导斜线，
- 并且删除rsync认为会允许符号链接逃出模块的层次结构的". "路径元素。
- 有一些棘手的方法可以解决这个问题，所以如果你选择这个参数组合，你最好相信你的用户。